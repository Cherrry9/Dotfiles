#!/bin/sh
color='#84a0c6'
full='━'
empty="┄"
value="${3:-10}"

bar() {
  i=0
  while [ $i -lt "$1" ]; do
    printf "$2"
    i=$((i + 1))
  done
}

notify() {
  barfull=$(bar $(($2 / 5)) "$full")
  barempty=$(bar $((20 - $2 / 5)) "$empty")
  dunstify -t 6000 -r 1000 -u normal "$1 Volume $2%" "<span color=\'$color\'>$barfull</span>$barempty"
}

case $1 in
  alsa)
  case $2 in
    up)   amixer set Master "$value%+";;
    down) amixer set Master "$value%-";;
  esac
  while IFS=[] read -r line vol _; do 
  case "$line" in
    *Right:*) vol="${vol%\%}"; break;;
  esac
  done <<EOF
$(amixer get Master)
EOF
  notify 'ALSA' "$vol"
  ;;
  mpc)
  case $2 in
    up)   mpc volume "+$value";;
    down) mpc volume "-$value";;
  esac
  vol=$(mpc volume | tail -c 5)
  notify 'MPD' ${vol%\%}
  ;;
esac
